#cloud-config
autoinstall:
  version: 1
  identity:
    hostname: harmonic-live
    username: root
    password: "$6$xBYkYF7cyAuFD4dl$t.8oDGsZoPvrkr4hTtKxnVDmWv18xJ1JhNseKzivSGjGlw1UVmkB0WzbDoYsveraErzgzYFlrJFqDkIcp/m4X1"
  keyboard:
    layout: us
    variant: ""
  proxy: http://44.10.4.101:8000
  apt:
    # even set to no/false, geoip lookup still happens
    geoip: false
    primary:
      - arches: [default]
        uri: "http://mirrors.aliyun.com/ubuntu/"
  refresh-installer:
    channel: edge
    update: yes
  ssh:
    install-server: true
    allow-pw: true
  storage:
    grub:
      update_nvram: true
    swap:
      size: 0
    layout:
      name: direct
  late-commands:
    - |
      if [ -d /sys/firmware/efi ]; then
        apt-get install -y efibootmgr
        efibootmgr -o $(efibootmgr | perl -n -e '/Boot(.+)\* ubuntu/ && print $1')
      fi
  package_update: true
  package_upgrade: true
  user-data:
    preserve_hostname: true
    disablee_root: false
    package_update: true
    package_upgrade: true
    ssh_pwauth: true
    disable_root: false
    users:
      - name: root
        lock_passwd: false
        password: "$6$xBYkYF7cyAuFD4dl$t.8oDGsZoPvrkr4hTtKxnVDmWv18xJ1JhNseKzivSGjGlw1UVmkB0WzbDoYsveraErzgzYFlrJFqDkIcp/m4X1"
        ssh_redirect_user: false
    runcmd:
      - sed -i -e '/^[#]*PermitRootLogin/s/^.*$/PermitRootLogin yes/' /etc/ssh/sshd_config
      - systemctl restart ssh
